import pandas as pd
import numpy as np

# Lire le CSV
df = pd.read_csv("Figaro2.csv")

def interpolate_speed(target_twa, target_tws):


    TWA=TWA%360
    if TWA>180:
        TWA-=180
    # Récupérer vecteurs et tableau
    TWA = df.iloc[:,0].to_numpy()
    TWS = df.columns[1:].astype(float)
    speeds = df.iloc[:,1:].to_numpy()

    # Trouver indices
    i = np.searchsorted(TWA, target_twa)
    j = np.searchsorted(TWS, target_tws)

    i_low = max(i-1, 0)
    i_high = min(i, len(TWA)-1)
    j_low = max(j-1, 0)
    j_high = min(j, len(TWS)-1)

    # 4 vitesses autour
    v_ll = speeds[i_low, j_low]
    v_lh = speeds[i_low, j_high]
    v_hl = speeds[i_high, j_low]
    v_hh = speeds[i_high, j_high]

    # Fraction pour interpolation
    if TWS[j_high] == TWS[j_low]:
        tx = 0
    else:
        tx = (target_tws - TWS[j_low]) / (TWS[j_high] - TWS[j_low])

    if TWA[i_high] == TWA[i_low]:
        ty = 0
    else:
        ty = (target_twa - TWA[i_low]) / (TWA[i_high] - TWA[i_low])

    # Interpolation bilinéaire
    v = (v_ll * (1 - tx) * (1 - ty) +
         v_lh * tx * (1 - ty) +
         v_hl * (1 - tx) * ty +
         v_hh * tx * ty)
    return v



speed = interpolate_speed(target_twa=31, target_tws=11)
print(speed)
